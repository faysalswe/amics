<div class="details-container content-block dx-card responsive-paddings">
    <div style="border-bottom: 2px solid #eee;padding-bottom: 10px;">
        <app-inventory-status [itemsId]="pmDetails.id" [secUserId]="secUserId"></app-inventory-status>
    </div>
    <br />
    <div class="pmdetails-container ">
        <dx-form id="pmDetails" [(formData)]="pmDetails" labelMode="floating" labelLocation="left"
            (submit)="handleSubmit($event)" [readOnly]="readOnly">
            <dxi-item itemType="group" [colCount]="2">
                <dxi-item itemType="group" [colCount]="2">
                    <dxi-item dataField="itemNumber" [colSpan]="1" [label]="{text:'Part Number'}">
                        <dxi-validation-rule type="required" message="Part Number is required">
                        </dxi-validation-rule>
                    </dxi-item>

                    <dxi-item dataField="itemType" editorType="dxLookup" [isRequired]="true"
                        [editorOptions]="{ label:'MFR',items: itemTypeList, showDataBeforeSearch:true,searchEnabled: true, searchExpr:'itemtype', displayExpr:'itemtype', valueExpr:'itemtype', searchMode:'contains' }">
                        <dxi-validation-rule type="required" message="MFR is required"></dxi-validation-rule>
                    </dxi-item>
                </dxi-item>
                <dxi-item itemType="group" [colCount]="4">
                    <!-- <dxi-item dataField="uomref" [label]="{ text: 'UOM' }"></dxi-item> -->
                    <dxi-item dataField="uomref" editorType="dxLookup" [isRequired]="true"
                        [editorOptions]="{ label:'UOM',items: uomList, showDataBeforeSearch:true,searchEnabled: true, searchExpr:'uom', displayExpr:'uom', valueExpr:'uom', searchMode:'contains'  }">
                        <dxi-validation-rule type="required" message="UOM is required"></dxi-validation-rule>
                    </dxi-item>
                    <dxi-item dataField="leadTime" [label]="{ text: 'Maintenance(days)' }"></dxi-item>
                    <!-- <dxi-item dataField="itemClass" [colSpan]="1"></dxi-item> -->
                    <dxi-item dataField="itemClass" editorType="dxLookup" [colSpan]="1"
                        [editorOptions]="{ label:'Item Class',items: itemClassList, showDataBeforeSearch:true,searchEnabled: true, searchExpr:'itemclass', displayExpr:'itemclass', valueExpr:'itemclass', showClearButton:true, searchMode:'contains'  }">
                    </dxi-item>
                    <!-- <dxi-item dataField="itemCode" [colSpan]="1"></dxi-item> -->
                    <dxi-item dataField="itemCode" editorType="dxLookup" [colSpan]="1"
                        [editorOptions]="{ label:'Item Code',items: itemCodeList, showDataBeforeSearch:true,searchEnabled: true, searchExpr:'itemcode', displayExpr:'itemcode', valueExpr:'itemcode', showClearButton:true, searchMode:'contains'  }">
                    </dxi-item>
                </dxi-item>
            </dxi-item>
            <dxi-item itemType="group" [colCount]="2">
                <dxi-item dataField="description" [colCount]="1" editorType="dxTextArea"
                    [label]="{text: 'Description (Max 150 characters)'}">

                </dxi-item>
                <dxi-item itemType="group" [colCount]="3">
                    <dxi-item dataField="cost" format="currency">
                        <dxo-format type="fixedPoint" [precision]="2"></dxo-format>
                    </dxi-item>
                    <dxi-item dataField="markup"></dxi-item>
                    <dxi-item dataField="price" format="currency">
                        <dxo-format type="fixedPoint" [precision]="2"></dxo-format>
                    </dxi-item>
                </dxi-item>
            </dxi-item>
            <dxi-item itemType="group" [colCount]="2">
                <dxi-item itemType="group" [colCount]="2">
                    <dxi-item dataField="warehouse" editorType="dxLookup" [colSpan]="1"
                        [editorOptions]="{ label:'Warehouse',items: warehouseNames, showDataBeforeSearch:true,searchEnabled: true,  showClearButton:true, searchMode:'contains',onValueChanged:updateWarehouseSelection  }">
                        <dxi-validation-rule type="required" message="Warehouse is required"></dxi-validation-rule>
                    </dxi-item>
                    <dxi-item dataField="location" editorType="dxLookup" [colSpan]="1"
                        [editorOptions]="{ label:'Location',items: validLocationNames, showDataBeforeSearch:true,searchEnabled: true,  showClearButton:true, searchMode:'contains' }">
                        <dxi-validation-rule type="required" message="Location is required"></dxi-validation-rule>
                    </dxi-item>

                </dxi-item>
                <dxi-item itemType="group" [colCount]="3">
                    <dxi-item [colCount]="1" editorType="dxRadioGroup" [label]="{text: ' '}" dataField="invType"
                        [isRequired]="true" [editorOptions]=" {items: invTypes,   layout: 'horizontal' }"
                        style="align-items:center;background-color: #F4F5F6;">
                        <dxi-validation-rule type="required" message="Inv Type is required"></dxi-validation-rule>
                    </dxi-item>
                    <dxi-item itemType="group" [colCount]="3" [colSpan]="2" class="checkClass"
                        style="align-items:center;background-color: #F4F5F6;">
                        <dxi-item editorType="dxCheckBox" dataField="obsolete" [label]="{text: ' '}"
                            [editorOptions]="{text: 'Obsolete'}">
                        </dxi-item>
                        <dxi-item editorType="dxCheckBox" dataField="userBit" [label]="{text: ' '}"
                            [editorOptions]="{ text: 'TAA'}">
                        </dxi-item>
                        <dxi-item itemType="simple" editorType="dxCheckBox" dataField="userBit2" [label]="{text: ' '}"
                            [editorOptions]="{ text: 'Create PO'}">
                        </dxi-item>
                    </dxi-item>
                </dxi-item>
            </dxi-item>
            <dxi-item itemType="group" [colCount]="2" [visible]="false">
                <dxi-item itemType="button" horizontalAlignment="left" [buttonOptions]="buttonOptions"
                    id="pmDetailsSubmit">
                </dxi-item>
            </dxi-item>
            <dxi-item itemType="group" [colCount]="2" [visible]="false">
                <dxi-item itemType="button" horizontalAlignment="left" [buttonOptions]="buttonOptions"
                    id="pmDetailsSubmit">
                </dxi-item>
            </dxi-item>
        </dx-form>
    </div>
</div>

<div class="details-container content-block dx-card responsive-paddings">
    <ng-container [ngSwitch]="selectedChild">
        <ng-container *ngSwitchCase="childType.BOM">
            <dx-data-grid id="gridContainer" [dataSource]="bomDetails" keyExpr="itemNumber" height="52vh"
                [focusedRowEnabled]="true" [allowColumnResizing]="true" [allowColumnReordering]="true"
                [columnAutoWidth]="true" [rowAlternationEnabled]="true" [showBorders]="true"
                (onKeyDown)="onKeyDown($event)" (onEditingStart)="logEvent('EditingStart')"
                (onInitNewRow)="logEvent('InitNewRow')" (onRowInserting)="logEvent('RowInserting')"
                (onRowInserted)="rowInserted($event)" (onRowUpdating)="rowUpdated($event)"
                (onRowUpdated)="logEvent('RowUpdated')" (onRowRemoving)="logEvent('RowRemoving')"
                (onRowRemoved)="rowRemoved($event)" (onSaving)="onSaving($event)" (onSaved)="logEvent('Saved')"
                (onEditCanceling)="logEvent('EditCanceling')" (onEditCanceled)="logEvent('EditCanceled')"
                (onSelectionChanged)="selectedChanged($event)">
                <dxo-row-dragging [allowReordering]="true" [onReorder]="onReorder" [showDragIcons]="true">
                </dxo-row-dragging>
                <dxo-scrolling mode="infinite"></dxo-scrolling>
                <dxo-selection mode="single"></dxo-selection>
                <dxo-editing mode="row" [allowUpdating]="!this.readOnly" [allowDeleting]="!this.readOnly"
                    [allowAdding]="!this.readOnly" newRowPosition="last">
                </dxo-editing>

                <dxi-column dataField="lineNum" dataType="number" [allowEditing]="false"></dxi-column>
                <dxi-column dataField="itemtype" caption="MFR." [allowEditing]="false"></dxi-column>
                <dxi-column dataField="itemNumber" caption="Part Number" [allowEditing]="true">
                    <dxi-validation-rule type="required"></dxi-validation-rule>
                    <dxi-validation-rule type="custom" [validationCallback]="validateItem" message="Invalid Part">
                    </dxi-validation-rule>
                </dxi-column>

                <dxi-column dataField="description" [allowEditing]="false"></dxi-column>
                <dxi-column dataField="quantity" [allowEditing]="true">
                    <dxi-validation-rule type="required"></dxi-validation-rule>
                </dxi-column>
                <dxi-column dataField="uomref" [allowEditing]="false" [width]="80"></dxi-column>
                <dxi-column dataField="ref" [allowEditing]="false" [width]="80"></dxi-column>
                <dxi-column dataField="cost" dataType="number" format="currency" [allowEditing]="false" [width]="120">
                    <dxo-format type="fixedPoint" [precision]="2"></dxo-format>
                </dxi-column>
                <dxi-column dataField="extCost" dataType="number" format="currency" [allowEditing]="false"
                    [width]="120">
                    <dxo-format type="fixedPoint" [precision]="2"></dxo-format>
                </dxi-column>
                <dxo-summary>
                    <dxi-total-item column="lineNum" summaryType="count"> </dxi-total-item>
                    <dxi-total-item column="cost" summaryType="sum" valueFormat="currency">
                        <dxo-format type="fixedPoint" [precision]="2">
                        </dxo-format>
                    </dxi-total-item>
                    <dxi-total-item column="extCost" summaryType="sum" valueFormat="currency">
                        <dxo-format type="fixedPoint" [precision]="2">
                        </dxo-format>
                    </dxi-total-item>
                </dxo-summary>
            </dx-data-grid>
        </ng-container>
        <ng-container *ngSwitchCase="childType.PO">
            <dx-data-grid id="gridContainer" [dataSource]="poDetails" keyExpr="id" height="52vh"
                [focusedRowEnabled]="true" [allowColumnResizing]="true" [rowAlternationEnabled]="true"
                [columns]="['linenum','pomain', 'supplier', 'quantity', 'received', 'somain']">
                <dxo-load-panel [enabled]="false"></dxo-load-panel>
                <dxo-scrolling mode="infinite"></dxo-scrolling>
                <dxo-selection mode="single"></dxo-selection>
            </dx-data-grid>
        </ng-container>
        <ng-container *ngSwitchCase="childType.Notes">
            <dx-data-grid id="gridContainer" [dataSource]="poNotes" keyExpr="id" height="52vh"
                [focusedRowEnabled]="true" [allowColumnResizing]="true" [rowAlternationEnabled]="true">
                <dxi-column dataField="lineNum" [width]="80"></dxi-column>
                <dxi-column dataField="notesRef" [width]="200"></dxi-column>
                <dxi-column dataField="notes"></dxi-column>
                <dxo-load-panel [enabled]="false"></dxo-load-panel>
                <dxo-scrolling mode="infinite"></dxo-scrolling>
                <dxo-selection mode="single"></dxo-selection>

            </dx-data-grid>
        </ng-container>
    </ng-container>
    <div>
        <dx-popup [width]="800" [height]="800" [showTitle]="true" title="search partnumber" [dragEnabled]="false"
            [closeOnOutsideClick]="false" [showCloseButton]="true" container=".dx-viewport"
            [(visible)]="popupF2Visible">
            <br />

            <app-pmsearch [componentType]="componentTypeF2"></app-pmsearch>
            <dxo-position at="center" my="center"> </dxo-position>
        </dx-popup>
    </div>
    <div>
        <dx-popup [width]="400" [height]="150" [showTitle]="true" title="Do you like to copy BOM as well?"
            [dragEnabled]="false" [closeOnOutsideClick]="false" [showCloseButton]="true" container=".dx-viewport"
            [(visible)]="popupCopyBomVisible">
            <dxi-toolbar-item widget="dxButton" toolbar="bottom" location="center" [options]="yesButtonOptions">
            </dxi-toolbar-item>
            <dxi-toolbar-item widget="dxButton" toolbar="bottom" location="center" [options]="noButtonOptions">
            </dxi-toolbar-item>
            <dxo-position at="center" my="center"> </dxo-position>

        </dx-popup>
        <dx-toast [(visible)]="toastVisible" [(type)]="toastType" [(message)]="toastMessage"></dx-toast>
    </div>
    <div>
        <dx-popup [width]="400" [height]="150" [showTitle]="true" title="Are you sure want to delete?"
            [dragEnabled]="false" [closeOnOutsideClick]="false" [showCloseButton]="true" container=".dx-viewport"
            [(visible)]="popupDeleteVisible">
            <dxi-toolbar-item widget="dxButton" toolbar="bottom" location="center" [options]="yesDeleteButtonOptions">
            </dxi-toolbar-item>
            <dxi-toolbar-item widget="dxButton" toolbar="bottom" location="center" [options]="noDeleteButtonOptions">
            </dxi-toolbar-item>
            <dxo-position at="center" my="center"> </dxo-position>

        </dx-popup>
        <dx-toast [(visible)]="toastVisible" [(type)]="toastType" [(message)]="toastMessage"></dx-toast>
    </div>
    <div>
        <dx-popup [width]="1200" [height]="800" [showTitle]="true" title="View Location" [dragEnabled]="false"
            [closeOnOutsideClick]="false" [showCloseButton]="true" container=".dx-viewport"
            [(visible)]="popupVLVisible">

            <br />

            <dx-data-grid id="gridContainer" [dataSource]="pmWHLocations" keyExpr="location" height="650"
                [allowColumnReordering]="true" [focusedRowEnabled]="true" [allowColumnResizing]="true"
                [rowAlternationEnabled]="true" (onExporting)="onExporting($event)" [showBorders]="true">
                <dxo-load-panel [enabled]="false"></dxo-load-panel>
                <dxo-scrolling mode="infinite"></dxo-scrolling>
                <dxo-sorting mode="multiple"></dxo-sorting>
                <dxo-selection mode="single"></dxo-selection>
                <dxo-filter-row [visible]="true" [applyFilter]="true"></dxo-filter-row>
                <dxo-header-filter [visible]="true"></dxo-header-filter>
                <dxo-search-panel [visible]="true" [width]="240" placeholder="Search..."></dxo-search-panel>
                <dxi-column dataField="warehouse"></dxi-column>
                <dxi-column dataField="location"></dxi-column>
                <dxi-column dataField="somain" caption="Equip Request"></dxi-column>
                <dxi-column dataField="name" caption="Project Name"></dxi-column>
                <dxi-column dataField="quantity"></dxi-column>
                <dxo-summary>
                    <dxi-total-item column="location" summaryType="count"> </dxi-total-item>
                </dxo-summary>
            </dx-data-grid>
            <dxo-export [enabled]="true"></dxo-export>
            <dxo-position at="center" my="center"> </dxo-position>
        </dx-popup>
    </div>
    <div>
        <dx-popup [width]="1200" [height]="800" [showTitle]="true" title="View Serial" [dragEnabled]="false"
            [closeOnOutsideClick]="false" [showCloseButton]="true" container=".dx-viewport"
            [(visible)]="popupVSVisible">

            <br />
            <dx-data-grid id="gridContainer" [dataSource]="pmSerials" keyExpr="serlot" height="650"
                [allowColumnReordering]="true" [focusedRowEnabled]="true" [allowColumnResizing]="true"
                [rowAlternationEnabled]="true">
                <dxo-load-panel [enabled]="false"></dxo-load-panel>
                <dxo-scrolling mode="infinite"></dxo-scrolling>
                <dxo-sorting mode="multiple"></dxo-sorting>
                <dxo-selection mode="single"></dxo-selection>
                <dxo-filter-row [visible]="true" [applyFilter]="true"></dxo-filter-row>
                <dxo-header-filter [visible]="true"></dxo-header-filter>
                <dxo-search-panel [visible]="true" [width]="240" placeholder="Search..."></dxo-search-panel>
                <dxi-column dataField="warehouse"></dxi-column>
                <dxi-column dataField="location"></dxi-column>
                <dxi-column dataField="cost"></dxi-column>
                <dxi-column dataField="serlot"></dxi-column>
                <dxi-column dataField="tagcol" caption="Tag No."></dxi-column>
                <dxi-column dataField="color_model" caption="Model"></dxi-column>
                <dxi-column dataField="expdate" caption="Exp Date"></dxi-column>
                <dxi-column dataField="actualSo" caption="Original ER"></dxi-column>
                <dxi-column dataField="currentSo" caption="Current ER"></dxi-column>
                <dxo-summary>
                    <dxi-total-item column="serlot" summaryType="count"> </dxi-total-item>
                </dxo-summary>
            </dx-data-grid>
            <dxo-export [enabled]="true" [allowExportSelectedData]="true"></dxo-export>
            <dxo-position at="center" my="center"> </dxo-position>
        </dx-popup>
    </div>
    <div>
        <dx-popup [width]="400" [height]="500" [showTitle]="true" title="Reason could not delete" [dragEnabled]="false"
            [closeOnOutsideClick]="false" [showCloseButton]="true" container=".dx-viewport"
            [(visible)]="popupDeleteMessages">
            <dxo-position at="center" my="center"> </dxo-position>
            <dx-list #grid id="gridContainer" [dataSource]="reasonsDelete" [hoverStateEnabled]="true"
                selectionMode="none" pageLoadMode="scrollBottom">
                <div *dxTemplate="let item of 'item'">
                    {{ item}}
                </div>
            </dx-list>
        </dx-popup>
        <dx-toast [(visible)]="toastVisible" [(type)]="toastType" [(message)]="toastMessage"></dx-toast>
    </div>
</div>